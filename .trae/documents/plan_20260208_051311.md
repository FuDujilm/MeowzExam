# 开发移动端应用 (Flutter) 的实施计划

您现有的 Next.js 项目后端架构非常完善，已经具备了支持移动端应用的能力，无需重写后端或进行大规模迁移。

## 核心架构方案

* **共享后端**: 保持现有的 Next.js 项目作为后端（Backend-for-Frontend），Flutter 应用直接调用现有的 API 接口。

* **独立目录**: 在项目根目录下创建 `mobile/` 目录存放 Flutter 代码，实现单体仓库 (Monorepo) 管理。

* **认证机制**: 利用现有的 `POST /api/auth/login` (验证码登录) 接口获取 JWT Token，并在 Flutter 端通过 HTTP Header (`Authorization: Bearer <token>`) 进行鉴权。

## 详细实施步骤

### 1. 准备工作

* **环境检查**: 确保您本地已安装 Flutter 开发环境 (`flutter doctor`)。

* **创建项目**:

  ```bash
  # 在项目根目录执行
  flutter create mobile
  ```

### 2. Flutter 依赖配置

在 `mobile/pubspec.yaml` 中添加核心依赖：

* `dio`: 强大的 HTTP 客户端，用于网络请求。

* `flutter_secure_storage`: 安全存储 JWT Token。

* `provider` / `riverpod` / `bloc`: 状态管理（按需选择）。

* `json_annotation` & `json_serializable`: JSON 模型生成。

### 3. Flutter 网络层封装 (关键代码)

我们将创建一个统一的 `ApiClient`，自动处理 Token 注入。

```dart
// 伪代码示例
class ApiClient {
  final Dio _dio = Dio(BaseOptions(baseUrl: "http://<您的电脑IP>:3001/api"));
  final _storage = const FlutterSecureStorage();

  ApiClient() {
    _dio.interceptors.add(InterceptorsWrapper(
      onRequest: (options, handler) async {
        // 自动添加 Token
        final token = await _storage.read(key: 'auth_token');
        if (token != null) {
          options.headers['Authorization'] = 'Bearer $token';
        }
        return handler.next(options);
      },
    ));
  }
}
```

### 4. 对接现有接口

直接复用您项目中的 API：

* **发送验证码**: `POST /api/auth/send-code`

* **登录获取 Token**: `POST /api/auth/login` (返回 JWT)

* **获取题目**: `GET /api/questions` (支持分页和筛选)

* **提交考试**: `POST /api/exam/submit`

### 5. 后端微调 (可选)

如果遇到跨域问题（Flutter Web 调试时），可能需要在 `next.config.js` 中添加 CORS 头。对于原生 App (iOS/Android)，通常不需要额外配置。

## 下一步行动

确认此计划后，我将：

1. 为您创建 `mobile` 目录结构的说明文档或辅助脚本。
2. 提供完整的 Flutter `AuthService` 和 \`UserUser

